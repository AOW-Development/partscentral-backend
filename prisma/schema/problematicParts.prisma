
// PROBLEMATIC PARTS MODELS

enum ProblematicPartType {
  DAMAGED
  DEFECTIVE
  WRONG_PRODUCT
}

model ProblematicPart {
  id                    String              @id @default(cuid())
  order                 Order               @relation(fields: [orderId], references: [id])
  orderId               String
  
  // Problem Type
  problemType           ProblematicPartType // DAMAGED | DEFECTIVE | WRONG_PRODUCT
  
  // ===== COMMON FIELDS (shared across all types) =====
  requestFromCustomer   String?             // "Refund" | "Replacement"
  returnShipping        String?             // "Not required" | "Yard Shipping" | "Own Shipping"
  customerRefund        String?             // "Yes" | "No"
  yardRefund            String?             // "Yes" | "No"
  amount                Decimal?            @db.Decimal(18,2) // Customer refund amount
  yardAmount            Decimal?            @db.Decimal(18,2) // Yard refund amount
  returnShippingPrice   Decimal?            @db.Decimal(18,2) // Only for "Own Shipping"
  productReturned       String?             // "Yes" | "No"
  
  // File uploads (JSON arrays of URLs)
  photos                Json?               // Array of photo URLs
  bolFile               String?             // BOL file URL
  
  // ===== DEFECTIVE PRODUCT SPECIFIC =====
  problemCategory       String?             // "Other" | "Damaged" | "Wrong Part" | "Defective" | "Missing"
  description           String?             @db.Text // Description of defective parts
  serviceDocuments      Json?               // Array of service document URLs
  
  // ===== WRONG PRODUCT SPECIFIC =====
  make                  String?             // Vehicle make
  model                 String?             // Vehicle model
  year                  String?             // Vehicle year
  specification         String?             // Part specification
  
  // ===== REPLACEMENT DATA (if requestFromCustomer = "Replacement") =====
  replacement           ProblematicPartReplacement?
  
  // Metadata
  metadata              Json?
  notes                 String?             @db.Text
  
  // Timestamps
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@unique([orderId]) // Ensure only ONE problematic part per order
  @@index([orderId])
  @@index([problemType])
}

model ProblematicPartReplacement {
  id                        String              @id @default(cuid())
  problematicPart           ProblematicPart     @relation(fields: [problematicPartId], references: [id])
  problematicPartId         String              @unique
  
  // Does Yard Have Replacement?
  hasReplacement            String?             // "Yes" | "No"
  
  // If Yes - Re-delivery Tracking
  carrierName               String?
  trackingNumber            String?
  eta                       String?
  
  // If No - Yard Refund & New Yard Information
  yardRefund                String?             // "Yes" | "No"
  yardRefundAmount          Decimal?            @db.Decimal(18,2)
  
  // New Yard Information
  yardName                  String?
  attnName                  String?
  yardAddress               String?             @db.Text
  yardPhone                 String?
  yardEmail                 String?
  warranty                  String?             // "30 Days" | "60 Days" | "90 Days" | "6 Months" | "1 Year"
  yardMiles                 String?
  shipping                  String?             // "Own Shipping" | "Yard Shipping"
  
  // Pricing
  replacementPrice          Decimal?            @db.Decimal(18,2)
  taxesPrice                Decimal?            @db.Decimal(18,2)
  handlingPrice             Decimal?            @db.Decimal(18,2)
  processingPrice           Decimal?            @db.Decimal(18,2)
  corePrice                 Decimal?            @db.Decimal(18,2)
  yardCost                  Decimal?            @db.Decimal(18,2) // Yard shipping cost
  totalBuy                  Decimal?            @db.Decimal(18,2) // Calculated total
  
  // PO Status
  pictureStatus             String?             // "Yes" | "No"
  poStatus                  String?
  poSentAt                  DateTime?
  poConfirmedAt             DateTime?
  
  // Re-delivery Tracking (for replacement from new yard)
  redeliveryCarrierName     String?
  redeliveryTrackingNumber  String?
  
  // Metadata
  metadata                  Json?
  
  // Timestamps
  createdAt                 DateTime            @default(now())
  updatedAt                 DateTime            @updatedAt
}

